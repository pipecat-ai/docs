---
title: "WhatsApp Business Calling API"
description: "Learn how to receive WhatsApp voice calls in your Pipecat application"
---

## Overview

This guide explains how to integrate WhatsApp Business voice calling into your Pipecat application using the **WhatsApp Cloud API** and **SmallWebRTC**. Once configured, your Pipecat bot will be able to receive and handle real-time voice calls directly from WhatsApp users.

---

## Prerequisites

### WhatsApp Business Setup

Before proceeding, ensure you have completed the following steps:

1. **Facebook Account** — Create one at [facebook.com](https://facebook.com)
2. **Facebook Developer Account** — Register at [developers.facebook.com](https://developers.facebook.com)
3. **WhatsApp Business App** — Create a new app via [Meta for Developers](https://developers.facebook.com/apps)
4. **Phone Number** — Add and verify a WhatsApp Business phone number
5. **Business Verification** — Required for production environments
6. **Webhook Configuration** — You’ll need a public webhook URL to receive call events

> **Note**: Voice calling is only available for WhatsApp Business API numbers with calling capability enabled.

For reference:
- [WhatsApp Cloud API Getting Started](https://developers.facebook.com/docs/whatsapp/cloud-api/get-started/)
- [Voice Calling API Documentation](https://developers.facebook.com/docs/whatsapp/cloud-api/calling/)
- [Webhook Setup](https://developers.facebook.com/docs/whatsapp/webhooks/)

---

## WhatsApp Configuration

### 1. Enable Voice Calls

To enable voice calls for your number:

1. Go to **Meta Developer Console** → **Configuration → Phone Numbers → Manage Phone Numbers**
2. Select your WhatsApp number
3. Under the **Calls** tab, enable **“Allow voice calls”**
4. Save the configuration

> For development, Meta provides a **free test number** valid for **90 days**.

---

### 2. Configure Webhook

Set up your webhook to receive call events:

1. In Meta Developer Console, navigate to **WhatsApp → Configuration → Webhooks**
2. Set your callback URL (e.g. `https://your-domain.com/`)
3. Enter a **verify token** (must match your environment variable `WHATSAPP_WEBHOOK_VERIFICATION_TOKEN`)
4. Click **Verify and Save**
5. Under **Webhook fields**, select: `calls` (required for voice call events)

---

### 3. Configure Access Token

1. Go to **WhatsApp → API Setup**
2. Click **Generate Access Token**
3. Use the generated token as your `WHATSAPP_TOKEN` environment variable
4. Note your **Phone Number ID** and configure it as `PHONE_NUMBER_ID`

---

## Pipecat Integration

WhatsApp works with plain `SmallWebRTCTransport`. All you need to do is configure WhatsApp as described above and provide the correct environment variables when starting your Pipecat bot.

### Example

```python
transport = SmallWebRTCTransport(
    webrtc_connection=webrtc_connection,
    params=TransportParams(
        audio_in_enabled=True,
        audio_out_enabled=True,
        vad_analyzer=SileroVADAnalyzer(),
    ),
)
```

### Environment Variables Example

Make sure your `.env` file includes:

```bash
WHATSAPP_TOKEN=<your_access_token>
WHATSAPP_WEBHOOK_VERIFICATION_TOKEN=<your_webhook_token>
PHONE_NUMBER_ID=<your_whatsapp_number_id>
WHATSAPP_APP_SECRET=<your_app_secret>
```

---

## Running the Server

1. **Install dependencies:**
   ```bash
   uv sync
   ```

2. **Configure environment variables:**
   ```bash
   cp env.example .env
   ```
   Edit `.env` and add your WhatsApp and Pipecat credentials.

3. **Start your Pipecat server:**
   ```bash
   python server.py
   ```

The server will now listen for incoming WhatsApp webhook events (including voice calls).

---

## Testing the Integration

1. From the WhatsApp app, call your registered WhatsApp Business number.
2. The call will be routed to your Pipecat application.
3. Your bot should automatically answer and begin the conversation.

---

## Troubleshooting

Common issues and their solutions:

1. **Expired WhatsApp Token**
   ```bash
   Error: invalid token
   ```
   **Solution:** Generate a new access token under **WhatsApp → API Setup**, then update your `WHATSAPP_APP_SECRET` and redeploy your agent.

2. **Webhook Verification Failed**
   - Ensure the verify token in Meta Developer Console matches your environment variable.
   - Confirm that your webhook URL is publicly accessible.

3. **Bot Not Answering Calls**
   - Verify your phone number has calling enabled.
   - Check that your environment variables are correctly set.
   - Ensure Pipecat is running and reachable.

4. **Invalid or Missing SDP**
   - Review WhatsApp’s [SDP Reference](https://developers.facebook.com/docs/whatsapp/cloud-api/calling/reference#sdp-overview-and-sample-sdp-structures)
   - Confirm your WebRTC setup supports both inbound and outbound audio.

---

## Notes

- Voice calling requires WhatsApp Business API access.
- Test phone numbers are valid for 90 days in development mode.
- Production deployment requires verified business credentials.
- You must have a working WebRTC media transport (e.g., `SmallWebRTCTransport`) for audio streaming.

---

## References

- [WhatsApp Cloud API – Getting Started](https://developers.facebook.com/docs/whatsapp/cloud-api/get-started/)
- [Voice Calling API Docs](https://developers.facebook.com/docs/whatsapp/cloud-api/calling/)
- [Webhook Configuration](https://developers.facebook.com/docs/whatsapp/webhooks/)
- [SDP Overview & Examples](https://developers.facebook.com/docs/whatsapp/cloud-api/calling/reference#sdp-overview-and-sample-sdp-structures)
